<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clodyness | Alpha Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        :root {
            --primary-purple: #9d50bb;
            --bg-dark: #050508;
            --glass: rgba(15, 15, 25, 0.85);
        }

        body, html {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow-x: hidden;
        }

        #particles-js {
            position: fixed;
            width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, #1a0b2e 0%, #050508 100%);
        }

        nav {
            display: flex; justify-content: center;
            padding: 20px 0;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(157, 80, 187, 0.2);
            position: fixed; width: 100%; top: 0; z-index: 100;
        }

        .nav-tabs { display: flex; gap: 10px; }

        .tab {
            cursor: pointer; color: #888; font-weight: 700; font-size: 13px;
            text-transform: uppercase; letter-spacing: 1.5px;
            transition: 0.3s; padding: 12px 25px; border-radius: 12px;
            border: none; background: transparent;
        }

        .tab:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab.active { color: white; background: rgba(157, 80, 187, 0.3); text-shadow: 0 0 10px var(--primary-purple); }

        .page-content {
            display: none; max-width: 1000px;
            margin: 160px auto 50px; padding: 20px;
            animation: slideUp 0.5s ease forwards;
        }
        .page-content.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(157, 80, 187, 0.1);
            padding: 40px; border-radius: 25px; backdrop-filter: blur(5px);
        }

        h1 { font-size: 70px; font-weight: 900; margin: 0; letter-spacing: -2px; }
        .purple-text { color: var(--primary-purple); }
        
        .btn {
            display: inline-block; padding: 15px 40px;
            background: var(--primary-purple); color: white;
            text-decoration: none; border-radius: 50px;
            font-weight: bold; transition: 0.3s; border: none; cursor: pointer;
            text-align: center;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(157, 80, 187, 0.4); }

        input {
            width: 100%; background: #08080c; border: 1px solid #1a1a2e;
            color: white; padding: 12px; margin: 10px 0 15px 0; border-radius: 10px; box-sizing: border-box;
        }
        input:disabled { opacity: 0.4; cursor: not-allowed; }
        label { font-size: 11px; color: #555; text-transform: uppercase; font-weight: bold; }
    </style>
</head>
<body>

    <div id="particles-js"></div>

    <nav>
        <div class="nav-tabs">
            <button class="tab active" onclick="openPage(event, 'home')">Home</button>
            <button class="tab" onclick="openPage(event, 'features')">Features</button>
            <button class="tab" onclick="openPage(event, 'store')">Store</button>
            <button class="tab" onclick="openPage(event, 'account')">Account</button>
        </div>
    </nav>

    <div id="home" class="page-content active">
        <center>
            <h1>CLODY<span class="purple-text">NESS</span></h1>
            <p style="color: #888; font-size: 20px;">The Next Generation of 1.8.8 Performance.</p>
            <br><a href="#" class="btn">DOWNLOAD ALPHA</a>
        </center>
    </div>

    <div id="features" class="page-content">
        <h2 class="purple-text">Built-in Modules</h2>
        <div class="card">
            <h3>Optimized Motion Blur</h3>
            <p style="color: #aaa;">Silky smooth motion blur that doesn't tank your FPS.</p>
        </div>
    </div>

    <div id="store" class="page-content">
        <center>
            <div class="card">
                <h2 class="purple-text">Cosmetics Store</h2>
                <p>Bib the Shopkeeper is currently organizing the capes.</p>
            </div>
        </center>
    </div>

    <div id="account" class="page-content">
        <center>
            <div class="card" style="max-width: 450px; text-align: left;">
                <h2 class="purple-text" style="margin-top: 0;">Clod Account</h2>

                <div id="logged-out-ui">
                    <p style="color: #888; margin-bottom: 20px;">Sign in to sync your coins and skins.</p>
                    
                    <label>Email Address</label>
                    <input type="email" id="auth-email" placeholder="email@example.com">
                    
                    <label>Password</label>
                    <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">

                    <div style="display: flex; gap: 10px;">
                        <button onclick="handleEmailAuth('login')" class="btn" style="flex: 1; font-size: 13px;">LOG IN</button>
                        <button onclick="handleEmailAuth('signup')" class="btn" style="flex: 1; font-size: 13px; background: #222;">SIGN UP</button>
                    </div>

                    <div style="text-align: center; margin: 15px 0; color: #333;">OR</div>

                    <button id="discord-login-btn" class="btn" style="width: 100%; background: #5865F2;">LOGIN WITH DISCORD</button>
                </div>

                <div id="logged-in-ui" style="display: none;">
                    <p id="user-greeting" style="text-align: center; font-weight: bold; color: var(--primary-purple);"></p>
                    
                    <label>Minecraft IGN</label>
                    <input type="text" id="mc-name" placeholder="Username">
                    
                    <label>Current Balance</label>
                    <input type="text" id="coin-display" value="0 Coins" disabled style="color: #ffcc00; font-weight: bold;">

                    <label>Player Skin (.png)</label>
                    <div style="border: 1px dashed #333; padding: 15px; border-radius: 10px; margin: 10px 0; text-align: center;">
                        <input type="file" id="skin-upload" accept=".png" style="font-size: 11px;">
                    </div>

                    <button class="btn" onclick="saveProfile()" style="width: 100%; margin-top: 10px;">SAVE CHANGES</button>
                    <button class="btn" onclick="logout()" style="width: 100%; margin-top: 10px; background: #222;">LOGOUT</button>
                </div>
            </div>
        </center>
    </div>

    <script>
        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://okbotrgwafkgxehsspng.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_6SZuxGeBbnXLJxYsHhq_4g_hb06s6T5';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- NAVIGATION ---
        function openPage(evt, pageName) {
            const pages = document.getElementsByClassName("page-content");
            for (let p of pages) p.classList.remove("active");
            const tabs = document.getElementsByClassName("tab");
            for (let t of tabs) t.classList.remove("active");
            document.getElementById(pageName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // --- CORE AUTH LOGIC ---
        async function checkUser() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            const loggedInUI = document.getElementById('logged-in-ui');
            const loggedOutUI = document.getElementById('logged-out-ui');

            if (user) {
                loggedOutUI.style.display = 'none';
                loggedInUI.style.display = 'block';
                
                // Fetch data from our custom 'profiles' table
                const { data: profile } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();

                if (profile) {
                    document.getElementById('user-greeting').innerText = `Logged in as ${profile.username || user.email}`;
                    document.getElementById('mc-name').value = profile.username || "";
                    document.getElementById('coin-display').value = `${profile.coins} Coins ðŸª™`;
                }
            } else {
                loggedOutUI.style.display = 'block';
                loggedInUI.style.display = 'none';
            }
        }

        // Handle Email Login or Signup
        async function handleEmailAuth(type) {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;

            if (!email || !password) return alert("Please fill in email and password.");

            let result;
            if (type === 'signup') {
                result = await supabaseClient.auth.signUp({ email, password });
                if (!result.error) alert("Success! Please check your email for a verification link.");
            } else {
                result = await supabaseClient.auth.signInWithPassword({ email, password });
            }

            if (result.error) alert(result.error.message);
            else checkUser();
        }

        // Discord OAuth
        document.getElementById('discord-login-btn').addEventListener('click', async () => {
            await supabaseClient.auth.signInWithOAuth({ provider: 'discord' });
        });

        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.reload();
        }

        // Save Profile Data
        async function saveProfile() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            const mcName = document.getElementById('mc-name').value;

            // Upsert: Updates if exists, creates if not
            const { error } = await supabaseClient.from('profiles').upsert({
                id: user.id,
                username: mcName
            });

            if (error) alert("Error saving profile: " + error.message);
            else alert("Profile saved to Clodyness Cloud!");
        }

        // --- VISUALS ---
        particlesJS("particles-js", {
            "particles": {
                "number": { "value": 60 },
                "color": { "value": "#9d50bb" },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.5 },
                "size": { "value": 3 },
                "line_linked": { "enable": true, "distance": 150, "color": "#6e48aa", "opacity": 0.4, "width": 1 },
                "move": { "enable": true, "speed": 2 }
            }
        });

        // Initialize user check on load
        checkUser();
    </script>
</body>
</html>
